projects:
  tda:
    active: true
    project_subdir: tda
    sources:
      - type: git
        url: "git@github.com:dterletskiy/linux_from_scratch.git"
        subdir: lfs
      - type: git
        url: "git@github.com:dterletskiy/umbs.git"
        subdir: umbs
      - type: git
        url: "git@github.com:dterletskiy/python_fw.git"
        subdir: pfw

  xen:
    active: true
    project_subdir: xen
    sources:
      - type: git
        url: ${XEN.SOURCE.GITHUB.URL}
        branch: ${XEN.SOURCE.GITHUB.BRANCH}
    builders:
      - type: make.xen
        subdir: "."
        product_subdir: "out/build"
        deploy_subdir: "out/deploy"
        defconfig: ${XEN.CONFIG.ARM64}
        arch: "arm64"
        compiler: "aarch64-linux-gnu-"
        jobs: 4
        targets:
          - "dist-xen"
        env:
          - ""
        artifacts:
          - "dist/install/boot/xen"
        deps:
          - ""

  u-boot:
    active: true
    project_subdir: loader/u-boot
    sources:
      - type: git
        url: ${UBOOT.SOURCE.GITHUB.URL}
        branch: ${UBOOT.SOURCE.GITHUB.BRANCH}
    patches:
      - type: copy
        content:
          - from: "tda/lfs/configuration/config/u-boot/v2022.07/qemu_arm64_defconfig/exp/defconfig"
            to: "configs/${UBOOT.CONFIG.ARM64}"
    builders:
      - type: make.uboot
        subdir: "."
        product_subdir: "out/build"
        deploy_subdir: "out/deploy"
        defconfig: ${UBOOT.CONFIG.ARM64}
        arch: "arm64"
        compiler: "aarch64-linux-gnu-"
        jobs: 4
        env:
          - ""
        artifacts:
          - "out/build/u-boot"
          - "out/build/u-boot.bin"
          - "out/build/scripts/dtc/dtc"
          - "out/build/tools/dumpimage"
          - "out/build/tools/fit_info"
          - "out/build/tools/mkenvimage"
          - "out/build/tools/mkimage"
          - "out/build/tools/img2srec"
        deps:
          - ""

  busybox:
    active: true
    project_subdir: linux/busybox
    sources:
      - type: git
        url: ${BUSYBOX.SOURCE.GITHUB.URL}
        branch: ${BUSYBOX.SOURCE.GITHUB.BRANCH}
    patches:
      - type: copy
        content:
          - from: "tda/lfs/configuration/config/busybox/1.35.0/arm64/exp/.config"
            to: "configs/${BUSYBOX.CONFIG.ARM64}"
    builders:
      - type: make.busybox
        subdir: "."
        product_subdir: "out/build"
        deploy_subdir: "out/deploy"
        defconfig: ${BUSYBOX.CONFIG.ARM64}
        arch: "arm64"
        compiler: "aarch64-linux-gnu-"
        jobs: 4
        env:
          - ""
        artifacts:
          - "_install"
        deps:
          - ""

  buildroot:
    active: true
    project_subdir: linux/buildroot
    sources:
      - type: git
        url: ${BUILDROOT.SOURCE.GITHUB.URL}
        branch: ${BUILDROOT.SOURCE.GITHUB.BRANCH}
    patches:
      - type: copy
        content:
          - from: "tda/lfs/configuration/config/buildroot/2022.05.2/qemu_aarch64_virt_defconfig/exp/defconfig"
            to: "configs/${BUILDROOT.CONFIG.ARM64}"
    builders:
      - type: make.buildroot
        subdir: "."
        product_subdir: "out/build"
        deploy_subdir: "out/deploy"
        defconfig: ${BUILDROOT.CONFIG.ARM64}
        arch: "arm64"
        compiler: "aarch64-linux-gnu-"
        jobs: 4
        env:
          - ""
        artifacts:
          - "output/images/rootfs.cpio"
          - "output/images/rootfs.ext2"
        deps:
          - ""

  kernel:
    active: true
    project_subdir: linux/kernel
    sources:
      - type: git
        url: ${KERNEL.SOURCE.GITHUB.URL}
        branch: ${KERNEL.SOURCE.GITHUB.BRANCH}
    patches:
      - type: copy
        content:
          - from: "tda/lfs/configuration/config/kernel/6.2/arm64/exp/defconfig"
            to: "arch/arm64/configs/${KERNEL.CONFIG.ARM64}"
    builders:
      - type: make.kernel
        subdir: "."
        product_subdir: "out/build"
        deploy_subdir: "out/deploy"
        defconfig: ${KERNEL.CONFIG.ARM64}
        arch: "arm64"
        compiler: "aarch64-linux-gnu-"
        jobs: 4
        env:
          - ""
        artifacts:
          - "out/deploy/vmlinuz-6.2.0"
          - "out/deploy/lib"
        deps:
          - ""





  rootfs:
    active: true
    project_subdir: rootfs/ubuntu/aarch64
    sources:
      - type: download
        url: ${UBUNTU.ROOTFS.SOURCE.ARM64}
        subdir: download
    patches:
      - type: unpack
        file: download/${UBUNTU.ROOTFS.NAME.ARM64}.tar.gz
        subdir: rootfs
    builders:
      - type: rootfs.ubuntu
        subdir: rootfs
        user: *UBUNTU_USER_ALIAS
        packages: *PACKAGES_ALIAS
        image:
          file: rootfs.img
          fs: ext4
          size: 4096 MB
          content:
            - action: extract
              from: rootfs/ubuntu/aarch64/download/${UBUNTU.ROOTFS.NAME.ARM64}.tar.gz
              to: "."
            - action: copy
              from: linux/kernel/out/deploy/lib/.
              to: lib

  rootfs-update:
    active: true
    project_subdir: rootfs/ubuntu/aarch64
    builders:
      - type: image.partition
        file: "rootfs.img"
        reuse: true
        content:
          - action: copy
            from: linux/kernel/out/deploy/lib/.
            to: lib
